option_settings:
  aws:elasticbeanstalk:container:nodejs:
    NodeCommand: "npm start"
container_commands:
  01_node_binary:
    command: "ln -sf `ls -td /opt/elasticbeanstalk/node-install/node-v7.6.0-linux-x64 | head -1`/bin/node /bin/node"
  02_npm_binary:
    command: "ln -sf `ls -td /opt/elasticbeanstalk/node-install/node-v7.6.0-linux-x64 | head -1`/bin/npm /bin/npm"
files:
  "/opt/elasticbeanstalk/hooks/appdeploy/post/90_create_certifiactes.sh":
    mode: "000755"
    owner: root
    group: root
    content: |
      mkdir /var/app/current/server/private
      openssl genrsa -out /var/app/current/server/private/privatekey.pem 1024
      openssl req -new -key /var/app/current/server/private/privatekey.pem -out /var/app/current/server/private/certrequest.csr
      openssl x509 -req -in /var/app/current/server/private/certrequest.csr -signkey /var/app/current/server/private/privatekey.pem -out /var/app/current/server/private/certificate.pem
  "/opt/elasticbeanstalk/hooks/appdeploy/post/91_load_ui_dependencies.sh":
    mode: "000755"
    owner: root
    group: root
    content: |
      npm --prefix /var/app/current/client install
  "/opt/elasticbeanstalk/hooks/appdeploy/post/92_build_ui.sh":
    mode: "000755"
    owner: root
    group: root
    content: |
      npm --prefix /var/app/current/client run build